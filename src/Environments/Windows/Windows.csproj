<?xml version="1.0" encoding="utf-8"?>
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>netstandard2.0</TargetFrameworks>
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
    <AutoGenerateBindingRedirects>true</AutoGenerateBindingRedirects>
    <GenerateBindingRedirectsOutputType>true</GenerateBindingRedirectsOutputType>
    <RootNamespace>Reko.Environments.Windows</RootNamespace>
    <AssemblyName>Reko.Environments.Windows</AssemblyName>
    <SolutionDir>$(ProjectDir)..\..\</SolutionDir>
  </PropertyGroup>
  <ItemGroup>
    <ProjectReference Include="..\..\Arch\X86\X86.csproj" />
    <ProjectReference Include="..\..\Libraries\Libc\Libc.csproj" />
  </ItemGroup>
  <ItemGroup>
    <TranslateHeader Include="msvcrt.inc" />
  </ItemGroup>
  <Target Name="CopyMetadata" AfterTargets="CoreBuild">
    <Message Importance="high" Text="*** TargetFrameworks: $(TargetFrameworks); MSBuildRuntimeType: $(MSBuildRuntimeType) ***" />
    <Msbuild Projects="$(ProjectDir)..\..\tools\c2xml\C2xml.csproj" Properties="Configuration=$(Configuration);TargetFramework=netcoreapp2.0" />
    <Copy SourceFiles="$(ProjectDir)$(OutDir)Reko.Environments.Windows.dll" DestinationFolder="$(SolutionDir)tools" />
    <Copy SourceFiles="$(SolutionDir)Arch\X86\$(OutDir)Reko.Arch.X86.dll" DestinationFolder="$(SolutionDir)tools" />
    <Exec Condition=" '$(MSBuildRuntimeType)' == 'Core' " Command="dotnet $(SolutionDir)tools/c2xml.dll -a x86-protected-32 -e win32 %(TranslateHeader.Identity) %(TranslateHeader.Filename).xml" />
    <Exec Condition=" '$(MSBuildRuntimeType)' != 'Core' " Command="&quot;$(SolutionDir)tools\c2xml.exe&quot; -a x86-protected-32 -e win32 %(TranslateHeader.Identity) %(TranslateHeader.Filename).xml" />
  </Target>
</Project>